# Torneos/models.py

from django.db import models
from django.urls import reverse

# =====================================================================
# Modelos de Torneos
# =====================================================================

class Torneo(models.Model):
    nombre = models.CharField(max_length=200)
    tipo = models.CharField(max_length=100) # Ej. "Nacional", "Regional"
    ubicacion = models.CharField(max_length=200)
    internacional = models.BooleanField(default=False)
    descripcion = models.TextField(blank=True, null=True)
    # Ruta relativa a la imagen estática principal del torneo
    imagen_estatica = models.CharField(
        max_length=255,
        blank=True,
        null=True,
        help_text="Ruta relativa a la imagen principal del torneo (ej. 'images/torneos/mi_torneo.jpg')"
    )

    def __str__(self):
        return self.nombre

    def get_absolute_url(self):
        return reverse('detalle_torneo', args=[str(self.id)])

class InformacionPorAnio(models.Model):
    torneo = models.ForeignKey(Torneo, related_name='informacion_por_anio', on_delete=models.CASCADE)
    anio = models.IntegerField()
    fecha_exacta = models.DateField(blank=True, null=True)
    ubicacion_especifica = models.CharField(max_length=200, blank=True, null=True)
    campeon = models.CharField(max_length=100)
    subcampeon = models.CharField(max_length=100, blank=True, null=True)
    participantes_cantidad = models.IntegerField(blank=True, null=True)
    resumen = models.TextField(blank=True, null=True)
    link_transmision = models.URLField(blank=True, null=True)
    # Ruta relativa a la imagen estática de la edición (ej. 'images/ediciones/edicion_2015.gif')
    imagen_edicion_estatica = models.CharField(
        max_length=255,
        blank=True,
        null=True,
        help_text="Ruta relativa a la imagen de la edición (ej. 'images/ediciones/edicion_2015.gif')"
    )

    class Meta:
        unique_together = ('torneo', 'anio')
        ordering = ['-anio'] # Ordenar por año descendente (más reciente primero)

    def __str__(self):
        return f"{self.torneo.nombre} - {self.anio}"


class ImagenAdicionalTorneo(models.Model):
    torneo = models.ForeignKey(Torneo, related_name='imagenes_adicionales', on_delete=models.CASCADE)
    # Ruta relativa a la imagen estática adicional (ej. 'images/extras/foto1.jpg')
    imagen_estatica = models.CharField(
        max_length=255,
        help_text="Ruta relativa a la imagen estática adicional (ej. 'images/extras/foto1.jpg')"
    )
    descripcion = models.CharField(max_length=255, blank=True, null=True)

    def __str__(self):
        return f"Imagen de {self.torneo.nombre} - {self.descripcion or 'Sin descripción'}"


class ImagenCarrusel(models.Model):
    # Ruta relativa a la imagen estática del carrusel (ej. 'images/carrusel/imagen_carrusel.png')
    imagen_estatica = models.CharField(
        max_length=255,
        help_text="Ruta relativa a la imagen para el carrusel principal (ej. 'images/carrusel/imagen_carrusel.png')"
    )
    descripcion = models.CharField(max_length=255, blank=True, null=True)
    link = models.URLField(blank=True, null=True, help_text="Enlace opcional al hacer clic en la imagen")
    orden = models.IntegerField(default=0, help_text="Orden de aparición en el carrusel")

    class Meta:
        ordering = ['orden'] # Ordenar por el campo 'orden'

    def __str__(self):
        return self.descripcion or f"Imagen Carrusel {self.id}"


# =====================================================================
# NUEVOS MODELOS DE REDES SOCIALES
# =====================================================================

class RedSocial(models.Model):
    """Representa una plataforma de red social (ej. YouTube, TikTok, Facebook)."""
    nombre = models.CharField(max_length=100, unique=True, help_text="Nombre de la plataforma (ej. YouTube, TikTok, Facebook)")
    # Ruta relativa al logo de la PLATAFORMA (ej. 'images/logos/youtube_main.png')
    logo_plataforma_estatico = models.CharField(
        max_length=255,
        blank=True,
        null=True,
        help_text="Ruta relativa al logo principal de la plataforma (ej. 'images/logos/youtube_main.png')"
    )
    orden = models.IntegerField(default=0, help_text="Orden de aparición de la plataforma en la página")

    class Meta:
        ordering = ['orden'] # Ordenar plataformas

    def __str__(self):
        return self.nombre

class CanalRedSocial(models.Model):
    """Representa un canal específico dentro de una plataforma de red social."""
    plataforma = models.ForeignKey(RedSocial, related_name='canales', on_delete=models.CASCADE,
                                   help_text="Plataforma de red social a la que pertenece este canal")
    nombre_canal = models.CharField(max_length=150, help_text="Nombre descriptivo del canal (ej. Canal de YouTube de MechAkuma)")
    link_canal = models.URLField(help_text="Enlace directo al canal o perfil")
    # Ruta relativa al logo ESPECÍFICO del canal (ej. 'images/logos/mech_akuma_youtube_logo.png')
    logo_canal_estatico = models.CharField(
        max_length=255,
        blank=True,
        null=True,
        help_text="Ruta relativa al logo específico del canal (ej. 'images/logos/mech_akuma_youtube_logo.png')"
    )
    orden = models.IntegerField(default=0, help_text="Orden de aparición dentro de su plataforma")

    class Meta:
        ordering = ['orden'] # Ordenar canales dentro de una plataforma

    def __str__(self):
        return f"{self.nombre_canal} ({self.plataforma.nombre})"
