{% extends "base.html" %}
{% load static %} {# Asegúrate de cargar static para las imágenes y CSS #}

{% block title %}Detalles de {{ torneo.nombre }}{% endblock %}

{% block content %}

<div class="torneo-detail-container">
    <h2>{{ torneo.nombre }}</h2>

    {# ESTO ES CORRECTO: Usamos el campo imagen_estatica y la etiqueta {% static %} #}
    {% if torneo.imagen_estatica %}
    <img src="{% static torneo.imagen_estatica %}" alt="Imagen de {{ torneo.nombre }}" class="torneo-detail-image">
    {% else %}
    {# Imagen por defecto si el torneo no tiene una imagen cargada o la ruta es inválida #}
    <img src="{% static 'images/default_tournament.png' %}" alt="Imagen por defecto de torneo"
        class="torneo-detail-image">
    {% endif %}

    <div class="detail-info-block">
        <p><strong>Tipo:</strong> {{ torneo.tipo }}</p>
        <p><strong>Ubicación:</strong> {{ torneo.ubicacion }}</p>
        {% if torneo.internacional %}
        <p style="color: #e67e22;"><strong>(Torneo Internacional)</strong></p>
        {% endif %}
        {% if torneo.descripcion %}
        <p><strong>Descripción:</strong> {{ torneo.descripcion|linebreaksbr }}</p>
        {% endif %}
        {# Asumiendo que 'descripcion_personalizada' es un campo en tu modelo Torneo #}
        {% if torneo.descripcion_personalizada %}
        <p><strong>Descripción Personalizada:</strong> {{ torneo.descripcion_personalizada|linebreaksbr }}</p>
        {% endif %}
    </div>

    {# --- SECCIÓN DE EDICIONES --- #}
    <div class="ediciones-container">
        <h2>Ediciones</h2>
        {% with torneo.informacion_por_anio.all as ediciones %}
        {% if ediciones %}
        <div class="ediciones-grid">
            {% for info_anio in ediciones %}
            <div class="edicion-card">
                {# IMAGEN DE EDICIÓN: Chequeo de nulos #}
                {% if info_anio.imagen_edicion_estatica %}
                <div class="edicion-image-wrapper">
                    <img src="{% static info_anio.imagen_edicion_estatica %}"
                        alt="Imagen de la edición {{ info_anio.anio }}" class="edicion-image">
                </div>
                {% else %}
                <div class="edicion-image-wrapper">
                    <img src="{% static 'images/default_edition.gif' %}"
                        alt="Imagen por defecto de la edición {{ info_anio.anio }}" class="edicion-image">
                </div>
                {% endif %}
                <div class="edicion-content">
                    <h4>Edición: {{ info_anio.anio }}</h4>
                    {# FECHA EXACTA: Chequeo de nulos antes de usar el filtro |date #}
                    {% if info_anio.fecha_exacta %}
                    <p><strong>Fecha:</strong> {{ info_anio.fecha_exacta|date:"d M Y" }}</p>
                    {% endif %}
                    {# UBICACIÓN ESPECÍFICA: Chequeo de nulos #}
                    {% if info_anio.ubicacion_especifica %}
                    <p><strong>Ubicación:</strong> {{ info_anio.ubicacion_especifica }}</p>
                    {% endif %}
                    <p><strong>Campeón:</strong> {{ info_anio.campeon }}</p>
                    {# SUBCAMPEÓN: Chequeo de nulos #}
                    {% if info_anio.subcampeon %}
                    <p><strong>Subcampeón:</strong> {{ info_anio.subcampeon }}</p>
                    {% endif %}
                    {# PARTICIPANTES CANTIDAD: Chequeo de nulos #}
                    {% if info_anio.participantes_cantidad %}
                    <p><strong>Participantes:</strong> {{ info_anio.participantes_cantidad }}</p>
                    {% endif %}
                    {# RESUMEN: Chequeo de nulos antes de usar el filtro |linebreaksbr #}
                    {% if info_anio.resumen %}
                    <div class="edicion-resumen">
                        <p><strong>Resumen:</strong> {{ info_anio.resumen|linebreaksbr }}</p>
                    </div>
                    {% endif %}
                    {# LINK TRANSMISIÓN: Chequeo de nulos #}
                    {% if info_anio.link_transmision %}
                    <a href="{{ info_anio.link_transmision }}" target="_blank" rel="noopener noreferrer"
                        class="link-transmision">
                        Ver Transmisión
                    </a>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="no-data-message">No hay información de ediciones disponible para este torneo aún.</p>
        {% endif %}
        {% endwith %}
    </div>
    {# --- FIN DE SECCIÓN DE EDICIONES --- #}

    <button onclick="history.back()" class="btn-back">← Volver</button>
</div>
{% endblock %}